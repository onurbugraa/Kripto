<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kripto Analiz Dashboard - Global Pro</title>
    <style>
        :root {
            --bg-dark: #0b0e14;
            --card-bg: #161a25;
            --text-primary: #eaecef;
            --text-secondary: #848e9c;
            --up-color: #0ecb81;
            --down-color: #f6465d;
            --accent: #fcd535;
            --liq-long: #0ecb81;
            --liq-short: #f6465d;
            --fed-blue: #3b82f6;
            --fed-gray: #4b5563;
            --rsi-neutral: #a855f7;
            --telegram-bg: #232e3c;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: var(--font-main);
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #2b3139;
            margin-bottom: 24px;
        }

        .logo { font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px; }
        .logo span { color: var(--accent); }
        .status-badge {
            background: rgba(14, 203, 129, 0.15);
            color: var(--up-color);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .status-dot { width: 8px; height: 8px; background: var(--up-color); border-radius: 50%; animation: pulse 1.5s infinite; }

        /* Grid Layout */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
        }

        /* √úST SIRA */
        .card-price     { grid-column: span 3; }
        .card-fear      { grid-column: span 3; }
        .card-liq-stat  { grid-column: span 3; }
        .card-fed       { grid-column: span 3; }

        /* ORTA SIRA */
        .card-macd      { grid-column: span 4; } 
        .card-rsi       { grid-column: span 4; }
        .card-bot       { grid-column: span 4; } /* BOT KUTUSU */

        /* ALT SIRA */
        .card-liq-details { grid-column: span 8; }
        .card-telegram    { grid-column: span 4; }
        .card-calendar    { grid-column: span 12; }

        /* Responsive */
        @media (max-width: 1200px) {
            .card-price, .card-fear, .card-liq-stat, .card-fed { grid-column: span 6; }
            .card-macd, .card-rsi, .card-bot { grid-column: span 12; } 
            .card-liq-details { grid-column: span 12; }
            .card-telegram { grid-column: span 12; }
            .card-calendar { grid-column: span 12; }
        }
        @media (max-width: 700px) {
            .card-price, .card-fear, .card-liq-stat, .card-fed { grid-column: span 12; }
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2b3139;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            min-height: 160px;
        }

        .card-header { color: var(--text-secondary); font-size: 0.85rem; font-weight: 600; margin-bottom: 12px; display: flex; justify-content: space-between; text-transform: uppercase; letter-spacing: 0.5px; align-items: center; }
        .big-value { font-size: 2rem; font-weight: 700; margin-bottom: 5px; transition: color 0.3s; }
        .sub-value { font-size: 0.85rem; display: flex; align-items: center; gap: 5px; font-weight: 500; color: var(--text-secondary); }

        .text-green { color: var(--up-color); }
        .text-red { color: var(--down-color); }
        .text-neutral { color: var(--rsi-neutral); }

        .meter-bg { height: 6px; background: #2b3139; border-radius: 3px; overflow: hidden; margin-top: auto; }
        .meter-fill { height: 100%; border-radius: 3px; transition: width 0.5s; }

        /* --- BOT KUTUSU √ñZEL (HEDEFLƒ∞) --- */
        .bot-price-display {
            font-size: 1.8rem;
            font-weight: 800;
            color: #fff;
            text-align: center;
            margin: 5px 0 10px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(255,255,255,0.1);
        }
        
        /* Hedef Fiyat Kutularƒ± */
        .bot-targets {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .target-box {
            flex: 1;
            background: rgba(0,0,0,0.3);
            padding: 8px 5px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #2b3139;
        }
        .target-label {
            font-size: 0.6rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            display: block;
            margin-bottom: 4px;
            font-weight: 700;
        }
        .target-price {
            font-weight: 800;
            font-size: 0.8rem;
            font-family: 'Courier New', monospace;
        }

        .bot-indicators-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        .ind-box {
            background: rgba(0,0,0,0.3);
            padding: 6px 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            border: 1px solid #2b3139;
        }
        .ind-name { color: var(--text-secondary); font-weight: 600; }
        .ind-status { font-weight: bold; }
        
        .bot-decision-bar {
            height: 6px;
            background: #2b3139;
            border-radius: 3px;
            position: relative;
            margin: 10px 0;
        }
        .decision-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            top: -2px;
            left: 50%;
            transition: left 0.5s ease;
            box-shadow: 0 0 5px #fff;
        }
        
        .bot-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #2b3139;
        }
        .switch { position: relative; display: inline-block; width: 36px; height: 18px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #4b5563; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--up-color); }
        input:checked + .slider:before { transform: translateX(18px); }
        .bot-status-text { font-size: 0.8rem; font-weight: bold; color: var(--text-secondary); }
        .bot-active { color: var(--up-color); animation: pulse 2s infinite; }

        .bot-log-container {
            max-height: 80px;
            overflow-y: auto;
            font-size: 0.7rem;
            margin-top: 10px;
            background: #0b0e14;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #2b3139;
        }
        .log-entry { margin-bottom: 2px; font-family: monospace; }
        .log-buy { color: var(--up-color); }
        .log-sell { color: var(--fed-blue); }
        .log-stop { color: var(--down-color); }
        .log-info { color: var(--text-secondary); }

        /* --- Dƒ∞ƒûER Bƒ∞LE≈ûENLER --- */
        .tg-feed-container { flex: 1; overflow-y: auto; padding-right: 5px; max-height: 450px; display: flex; flex-direction: column; gap: 12px; }
        .tg-feed-container::-webkit-scrollbar { width: 4px; }
        .tg-feed-container::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .tg-msg { background: #1f2937; border-radius: 12px; padding: 12px; position: relative; font-size: 0.85rem; border-left: 4px solid transparent; animation: slideInRight 0.3s ease-out; color: #e5e7eb; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .tg-long { border-left-color: var(--up-color); background: linear-gradient(90deg, rgba(14, 203, 129, 0.1) 0%, rgba(31, 41, 55, 1) 100%); }
        .tg-short { border-left-color: var(--down-color); background: linear-gradient(90deg, rgba(246, 70, 93, 0.1) 0%, rgba(31, 41, 55, 1) 100%); }
        .tg-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-weight: 700; font-size: 0.95rem; }
        .tg-row { display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 0.8rem; }
        .tg-time { font-size: 0.7rem; color: var(--text-secondary); margin-top: 6px; text-align: right; font-style: italic; }

        .rsi-gauge-container { position: relative; height: 8px; background: linear-gradient(90deg, var(--up-color) 0%, var(--rsi-neutral) 50%, var(--down-color) 100%); border-radius: 4px; margin-top: 10px; margin-bottom: 8px; }
        .rsi-marker { position: absolute; top: -4px; width: 4px; height: 16px; background: #fff; border: 1px solid #000; transform: translateX(-50%); transition: left 0.5s ease; }
        .rsi-zones { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 10px; }
        .rsi-comment-box { background: rgba(255, 255, 255, 0.05); border-left: 3px solid var(--text-secondary); padding: 8px; font-size: 0.8rem; border-radius: 0 4px 4px 0; line-height: 1.4; }
        .fed-scenario { margin-bottom: 12px; }
        .fed-sc-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px; font-weight: 600; }
        .fed-sc-bar-bg { height: 8px; background: #2b3139; border-radius: 4px; overflow: hidden; }
        .fed-sc-bar { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .fed-history-box { margin-top: 12px; padding-top: 10px; border-top: 1px solid #2b3139; }
        .hist-title { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; }
        .hist-row { display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 4px; }
        .hist-val { font-weight: bold; color: #eaecef; }
        .timeframe-row { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #2b3139; padding-bottom: 20px; }
        .tf-box { flex: 1; background: #0b0e14; border: 1px solid #2b3139; border-radius: 8px; padding: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .tf-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 5px; letter-spacing: 0.5px; text-align: center; }
        .tf-val { font-size: 1.5rem; font-weight: 800; color: #fff; }
        .tf-sub { font-size: 0.7rem; color: var(--text-secondary); margin-top: 4px; }
        .ls-split-container { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 0 10px; }
        .ls-box { text-align: center; width: 45%; }
        .ls-title { font-size: 0.8rem; font-weight: 600; margin-bottom: 5px; display: block; opacity: 0.8; }
        .ls-val { font-size: 1.4rem; font-weight: 700; }
        .ls-bar-wrapper { position: relative; height: 24px; background: #2b3139; border-radius: 6px; overflow: hidden; margin: 0 10px 20px 10px; display: flex; }
        .ls-bar-long { height: 100%; background: var(--liq-long); width: 50%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-start; padding-left: 10px; color: #000; font-weight: bold; font-size: 0.75rem; }
        .ls-bar-short { height: 100%; background: var(--liq-short); width: 50%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: #fff; font-weight: bold; font-size: 0.75rem; }
        .liq-stream-container { background: #0b0e14; border: 1px solid #2b3139; border-radius: 8px; height: 250px; overflow-y: hidden; position: relative; }
        .liq-stream-list { padding: 10px; display: flex; flex-direction: column; gap: 6px; }
        .liq-item { display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; padding: 8px 15px; background: #161a25; border-radius: 6px; animation: slideIn 0.3s ease-out; border-left: 4px solid transparent; }
        .liq-long { border-left-color: var(--liq-long); } .liq-short { border-left-color: var(--liq-short); }
        .coin-badge { background: #2b3139; color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; margin-right: 10px; font-weight: bold; }
        .macd-dual-container { display: flex; gap: 20px; height: 100%; }
        .macd-col { flex: 1; display: flex; flex-direction: column; border-right: 1px solid #2b3139; padding-right: 10px; }
        .macd-col:last-child { border-right: none; padding-right: 0; padding-left: 10px; }
        .macd-tf-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 5px; font-weight: 700; }
        .macd-signal-big { font-size: 1.4rem; font-weight: 800; margin-bottom: 5px; letter-spacing: -0.5px; }
        .macd-mini-stats { font-size: 0.75rem; color: var(--text-secondary); display: flex; justify-content: space-between; margin-bottom: 10px; }
        .macd-hist-mini { display: flex; align-items: flex-end; height: 40px; gap: 3px; opacity: 0.8; margin-top: auto; }
        .hist-bar { flex: 1; background: #2b3139; border-radius: 2px; transition: height 0.3s, background 0.3s; }
        .tradingview-widget-container { height: 100%; width: 100%; min-height: 120px; }
        .calendar-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .calendar-table th { text-align: left; color: var(--text-secondary); padding-bottom: 10px; border-bottom: 1px solid #2b3139; font-weight: 600; }
        .calendar-table td { padding: 10px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #e5e7eb; }
        .cal-time { width: 15%; color: var(--accent); font-weight: bold; font-size: 0.8rem; }
        .cal-impact { width: 12%; }
        .cal-event { width: 50%; font-weight: 600; }
        .cal-forecast { width: 15%; color: var(--text-secondary); text-align: right; }
        .cal-impact-high { color: #fcd535; letter-spacing: 1px; font-size: 0.7rem; } 
        .cal-impact-medium { color: #fb923c; letter-spacing: 1px; font-size: 0.7rem; } 
        .cal-row:hover { background: rgba(255,255,255,0.02); }
        .cal-analysis { font-size: 0.7rem; color: var(--text-secondary); font-style: italic; margin-left: 0; display: block; margin-top: 2px; font-weight: normal; opacity: 0.8; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        
        @media (max-width: 600px) { 
            .timeframe-row, .macd-dual-container { flex-direction: column; gap: 10px; } 
            .macd-col { border-right: none; border-bottom: 1px solid #2b3139; padding-bottom: 10px; padding-right: 0; padding-left: 0; } 
            .macd-col:last-child { border-bottom: none; padding-top: 10px; padding-left: 0; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">Kripto<span>Analiz</span> Global</div>
        <div class="status-badge">
            <div class="status-dot"></div> Kriz Modu: Aktif
        </div>
    </header>

    <div class="grid-container">
        
        <!-- 1. BTC Fiyatƒ± -->
        <div class="card card-price">
            <div class="card-header">
                <span>Bitcoin (BTC)</span>
                <span style="color:var(--accent)">Binance</span>
            </div>
            <div class="big-value" id="btc-price">Wait...</div>
            <div class="sub-value" id="btc-change">--</div>
            <div class="meter-bg">
                <div class="meter-fill" style="width: 60%; background: var(--text-secondary); opacity:0.3"></div>
            </div>
        </div>

        <!-- 2. Korku Endeksi -->
        <div class="card card-fear">
            <div class="card-header">Piyasa Duygusu</div>
            <div style="display:flex; justify-content:space-between; align-items:baseline;">
                <div class="big-value" id="fear-val">--</div>
                <div id="fear-text" style="font-weight:600; font-size:0.9rem;">Y√ºkleniyor</div>
            </div>
            <div class="meter-bg">
                <div class="meter-fill" id="fear-bar" style="width: 0%;"></div>
            </div>
        </div>

        <!-- 3. Lƒ∞Kƒ∞DASYON √ñZETƒ∞ -->
        <div class="card card-liq-stat">
            <div class="card-header">
                <span>Rekt √ñzeti (24s)</span>
                <span style="color:var(--down-color)">Tahmini</span>
            </div>
            <div class="big-value text-red" id="global-liq-total-small" style="font-family: 'Courier New', monospace;">$0</div>
            <div class="sub-value">
                <span style="color:var(--text-secondary)">Global Piyasalar</span>
            </div>
             <div class="meter-bg" style="margin-top: auto;">
                <div class="meter-fill" style="width: 90%; background: var(--down-color); opacity:0.8"></div>
            </div>
        </div>

        <!-- 4. FED FAƒ∞Z MONƒ∞T√ñR√ú -->
        <div class="card card-fed">
            <div class="card-header">
                <span>Fed Beklentisi (10 Ara)</span>
                <span style="color:var(--fed-blue)">Inv.com</span>
            </div>
            
            <div class="fed-scenario">
                <div class="fed-sc-label">
                    <span class="text-green">‚ñº 25bp ƒ∞ndirim (3.50-3.75)</span>
                    <span class="text-green" id="fed-cut-val">%67.8</span>
                </div>
                <div class="fed-sc-bar-bg">
                    <div class="fed-sc-bar" id="fed-cut-bar" style="width: 67.8%; background: var(--up-color);"></div>
                </div>
            </div>

            <div class="fed-scenario">
                <div class="fed-sc-label">
                    <span style="color:var(--text-secondary)">‚ñ† Sabit (3.75-4.00)</span>
                    <span style="color:var(--text-secondary)" id="fed-hold-val">%32.2</span>
                </div>
                <div class="fed-sc-bar-bg">
                    <div class="fed-sc-bar" id="fed-hold-bar" style="width: 32.2%; background: var(--text-secondary);"></div>
                </div>
            </div>

            <div class="fed-history-box">
                <div class="hist-title">ƒ∞ndirim ƒ∞htimali Deƒüi≈üimi (Trend)</div>
                <div class="hist-row">
                    <span style="color:var(--text-secondary)">D√ºn</span>
                    <span class="hist-val text-red">%28.5</span>
                </div>
                <div class="hist-row">
                    <span style="color:var(--text-secondary)">Ge√ßen Hafta</span>
                    <span class="hist-val text-red">%39.8</span>
                </div>
            </div>
        </div>

        <!-- 5. MACD G√ñSTERGESƒ∞ -->
        <div class="card card-macd">
            <div class="card-header">
                <span>MACD Trend (4H / 1D)</span>
                <span class="status-badge" style="background:#2b3139; color:#fff; padding:2px 8px;">EMA (12, 26, 9)</span>
            </div>
            
            <div class="macd-dual-container">
                <div class="macd-col">
                    <span class="macd-tf-label" style="color:var(--accent)">4 SAATLƒ∞K (ORTA VADE)</span>
                    <div class="macd-signal-big" id="macd-status-4h">--</div>
                    <div class="macd-mini-stats">
                        <span>MACD: <b id="val-macd-4h" style="color:#fff">0.00</b></span>
                        <span>H: <b id="val-hist-4h" style="color:#fff">0.00</b></span>
                    </div>
                    <div class="macd-hist-mini" id="hist-bars-4h"></div>
                </div>

                <div class="macd-col">
                    <span class="macd-tf-label">G√úNL√úK (UZUN VADE)</span>
                    <div class="macd-signal-big" id="macd-status-1d">--</div>
                    <div class="macd-mini-stats">
                        <span>MACD: <b id="val-macd-1d" style="color:#fff">0.00</b></span>
                        <span>H: <b id="val-hist-1d" style="color:#fff">0.00</b></span>
                    </div>
                    <div class="macd-hist-mini" id="hist-bars-1d"></div>
                </div>
            </div>
        </div>

        <!-- 6. G√úNL√úK RSI -->
        <div class="card card-rsi">
            <div class="card-header">
                <span>G√ºnl√ºk RSI Analizi</span>
                <span class="status-badge" style="background:#2b3139; color:#fff; padding:2px 8px;">Kaynak: Bybit</span>
            </div>
            <div style="display:flex; align-items:baseline; gap:10px;">
                <div class="big-value" id="rsi-val">--</div>
                <div id="rsi-label" style="font-weight:700; font-size:1rem; color:var(--text-secondary);">Hesaplanƒ±yor</div>
            </div>
            <div class="rsi-gauge-container">
                <div class="rsi-marker" id="rsi-marker" style="left: 50%;"></div>
            </div>
            <div class="rsi-zones">
                <span>0</span><span>30</span><span>50</span><span>70</span><span>100</span>
            </div>
            <div class="rsi-comment-box" id="rsi-comment">RSI verisi √ßekiliyor...</div>
        </div>

        <!-- 7. [YENƒ∞] PRO BOT KUTUSU -->
        <div class="card card-bot">
            <div class="card-header">
                <span>‚ö° Pro AI Trader (Multi-Indicator)</span>
                <span class="status-badge" style="background:var(--accent); color:#000;">Sanal (Paper)</span>
            </div>
            
            <!-- CANLI Fƒ∞YAT G√ñSTERGESƒ∞ -->
            <div class="bot-price-display" id="bot-live-price">--</div>

            <!-- HEDEFLER (YENƒ∞ EKLENEN KISIM) -->
            <div class="bot-targets">
                <div class="target-box" style="border-color: var(--up-color);">
                    <span class="target-label text-green">G√úVENLƒ∞ ALIM (Dƒ∞P)</span>
                    <div class="target-price text-green" id="target-buy">--</div>
                </div>
                <div class="target-box" style="border-color: var(--fed-blue);">
                    <span class="target-label" style="color:var(--fed-blue)">HEDEF SATI≈û (TP)</span>
                    <div class="target-price" style="color:var(--fed-blue)" id="target-sell">--</div>
                </div>
                <div class="target-box" style="border-color: var(--down-color);">
                    <span class="target-label text-red">STOP LOSS</span>
                    <div class="target-price text-red" id="target-stop">--</div>
                </div>
            </div>

            <!-- ƒ∞NDƒ∞KAT√ñR MATRƒ∞Sƒ∞ -->
            <div class="bot-indicators-grid">
                <div class="ind-box" id="ind-box-rsi">
                    <span class="ind-name">RSI</span>
                    <span class="ind-status" id="ind-val-rsi">--</span>
                </div>
                <div class="ind-box" id="ind-box-macd">
                    <span class="ind-name">MACD</span>
                    <span class="ind-status" id="ind-val-macd">--</span>
                </div>
                <div class="ind-box" id="ind-box-bb">
                    <span class="ind-name">BOLL</span>
                    <span class="ind-status" id="ind-val-bb">--</span>
                </div>
                <div class="ind-box" id="ind-box-ema">
                    <span class="ind-name">EMA</span>
                    <span class="ind-status" id="ind-val-ema">--</span>
                </div>
            </div>

            <!-- Sƒ∞NYAL G√úC√ú BAR -->
            <div style="font-size:0.7rem; color:var(--text-secondary); display:flex; justify-content:space-between; margin-bottom:2px;">
                <span>G√º√ßl√º Satƒ±≈ü</span>
                <span>N√∂tr</span>
                <span>G√º√ßl√º Alƒ±≈ü</span>
            </div>
            <div class="bot-decision-bar">
                <div class="decision-marker" id="decision-marker"></div>
            </div>
            
            <div class="bot-controls">
                <span class="bot-status-text" id="bot-status-text">Bot Durduruldu</span>
                <label class="switch">
                    <input type="checkbox" id="bot-toggle" onchange="toggleBot()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="bot-log-container" id="bot-log">
                <div class="log-entry log-info">[Sistem] 4 Katmanlƒ± Analiz + Hedef Fiyatlar Hazƒ±r.</div>
            </div>
        </div>

        <!-- 8. Lƒ∞Kƒ∞DASYON DETAY PANELƒ∞ -->
        <div class="card card-liq-details">
            <div class="card-header">
                <span>üö® Detaylƒ± Likidasyon Verileri</span>
                <span class="status-badge" style="background:transparent; padding:0; font-size:0.7rem; color:var(--accent);">√áoklu Borsa Akƒ±≈üƒ±</span>
            </div>
            
            <div class="timeframe-row">
                <div class="tf-box" id="box-24h" style="border-color: rgba(246, 70, 93, 0.3);">
                    <span class="tf-label">SON 24 SAAT</span>
                    <span class="tf-val text-red" id="detail-24h-val">$0</span>
                    <span class="tf-sub">Global Toplam</span>
                </div>
                <div class="tf-box" id="box-4h" style="border-color: var(--accent);">
                    <span class="tf-label" style="color:var(--accent)">SON 4 SAAT</span>
                    <span class="tf-val" style="color:var(--accent)" id="detail-4h-val">$0</span>
                    <span class="tf-sub">Orta Vade</span>
                </div>
                <div class="tf-box" id="box-1h" style="border-color: var(--fed-blue);">
                    <span class="tf-label" style="color:var(--fed-blue)">SON 1 SAAT</span>
                    <span class="tf-val" style="color:var(--fed-blue)" id="detail-1h-val">$0</span>
                    <span class="tf-sub">Anlƒ±k Akƒ±≈ü</span>
                </div>
            </div>
            
            <div style="text-align:center; margin-bottom:10px; font-size:0.8rem; color:var(--text-secondary);">24 SAATLƒ∞K DAƒûILIM (CANLI)</div>
            <div class="ls-split-container">
                <div class="ls-box">
                    <span class="ls-title text-green" style="border-bottom: 2px solid var(--liq-long); display:inline-block; padding-bottom:3px;">LONG</span>
                    <div class="ls-val text-green" id="long-liq-detail">$0</div>
                </div>
                <div class="ls-box">
                    <span class="ls-title text-red" style="border-bottom: 2px solid var(--liq-short); display:inline-block; padding-bottom:3px;">SHORT</span>
                    <div class="ls-val text-red" id="short-liq-detail">$0</div>
                </div>
            </div>

            <div class="ls-bar-wrapper">
                <div class="ls-bar-long" id="bar-long">%80</div>
                <div class="ls-bar-short" id="bar-short">%20</div>
            </div>
        </div>

        <!-- 9. TELEGRAM TARZI Lƒ∞Kƒ∞DASYON AKI≈ûI -->
        <div class="card card-telegram" style="padding:0;">
            <div class="card-header" style="padding: 15px 15px 5px 15px;">
                <span>üí¨ Binance Liquidations</span>
                <a href="https://t.me/BinanceLiquidations" target="_blank" class="status-badge" style="text-decoration:none; cursor:pointer;">Telegram</a>
            </div>
            <div class="tg-feed-container" id="tg-feed">
                <div class="tg-msg" style="text-align:center; color:#666;">Veriler y√ºkleniyor...</div>
            </div>
        </div>

        <!-- 10. ABD EKONOMƒ∞K TAKVƒ∞Mƒ∞ -->
        <div class="card card-calendar">
            <div class="card-header">
                <span>üá∫üá∏ ABD Ekonomik Takvimi (Bu Hafta)</span>
                <span class="status-badge" style="background:#2b3139; color:#fff;">2 & 3 Yƒ±ldƒ±zlƒ± Veriler</span>
            </div>
            <table class="calendar-table">
                <thead>
                    <tr>
                        <th>Zaman</th>
                        <th>√ñnem</th>
                        <th>Olay & Etki Analizi</th>
                        <th style="text-align:right">Beklenti</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 25 Kasƒ±m -->
                    <tr class="cal-row">
                        <td class="cal-time">25 Kas 18:00</td>
                        <td class="cal-impact cal-impact-high">‚≠ê‚≠ê‚≠ê</td>
                        <td>CB T√ºketici G√ºveni (Kas)<span class="cal-analysis">Veri < 100 gelirse -> DXY D√º≈üer, BTC Pozitif</span></td>
                        <td class="cal-forecast">102.0</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time">25 Kas 18:00</td>
                        <td class="cal-impact cal-impact-medium">‚≠ê‚≠ê</td>
                        <td>Yeni Konut Satƒ±≈ülarƒ± (Eki)<span class="cal-analysis">Y√ºksek gelirse ekonomi canlƒ± demektir.</span></td>
                        <td class="cal-forecast">725K</td>
                    </tr>
                    <!-- 26 Kasƒ±m -->
                    <tr class="cal-row">
                        <td class="cal-time">26 Kas 16:30</td>
                        <td class="cal-impact cal-impact-high">‚≠ê‚≠ê‚≠ê</td>
                        <td>GSYƒ∞H (GDP) (3. √áeyrek)<span class="cal-analysis">Beklenti Altƒ± -> Resesyon korkusu -> BTC D√º≈üebilir</span></td>
                        <td class="cal-forecast">%2.9</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time">26 Kas 16:30</td>
                        <td class="cal-impact cal-impact-high">‚≠ê‚≠ê‚≠ê</td>
                        <td>ƒ∞≈üsizlik Ba≈üvurularƒ±<span class="cal-analysis">Y√ºksek Gelirse -> Faiz ƒ∞ndirimi ƒ∞htimali Artar -> BTC Y√ºkselir</span></td>
                        <td class="cal-forecast">220K</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time">26 Kas 16:30</td>
                        <td class="cal-impact cal-impact-medium">‚≠ê‚≠ê</td>
                        <td>Dayanƒ±klƒ± Mal Sipari≈üleri (Eki)<span class="cal-analysis">Sanayi √ºretimi sinyali.</span></td>
                        <td class="cal-forecast">%0.5</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time">26 Kas 18:00</td>
                        <td class="cal-impact cal-impact-high" style="color:#ef4444;">‚≠ê‚≠ê‚≠ê</td>
                        <td>√áekirdek PCE Fiyat Endeksi<span class="cal-analysis">Fed'in favori enflasyon verisi. D√º≈ü√ºk gelirse -> RALLƒ∞!</span></td>
                        <td class="cal-forecast">%2.8</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time">26 Kas 18:00</td>
                        <td class="cal-impact cal-impact-medium">‚≠ê‚≠ê</td>
                        <td>Chicago PMI (Kas)<span class="cal-analysis">50 altƒ± daralma sinyalidir.</span></td>
                        <td class="cal-forecast">48.2</td>
                    </tr>
                    <tr class="cal-row">
                        <td class="cal-time" style="color:#666;">27 Kas</td>
                        <td class="cal-impact">‚≠ê‚≠ê</td>
                        <td>≈û√ºkran G√ºn√º (Tatil)<span class="cal-analysis">D√º≈ü√ºk hacim, ani hareket riski.</span></td>
                        <td class="cal-forecast">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        // --- 1. YARDIMCI FONKSƒ∞YONLAR (EN BA≈ûTA) ---
        function formatMoney(num, isFull = false) {
            if (isFull) {
                return '$' + Math.floor(num).toLocaleString('en-US');
            }
            if (num >= 1000000000) return '$' + (num / 1000000000).toFixed(2) + 'B';
            if (num >= 1000000) return '$' + (num / 1000000).toFixed(2) + 'M';
            if (num >= 1000) return '$' + (num / 1000).toFixed(2) + 'K';
            return '$' + num.toFixed(2);
        }

        // --- 2. GLOBAL DEƒûƒ∞≈ûKENLER ---
        let currentPrice = 0;
        let longLiqTotal = 1524000000;
        let shortLiqTotal = 342000000;
        let hourlyTotal = (longLiqTotal + shortLiqTotal) / 15; 
        let fourHourTotal = (longLiqTotal + shortLiqTotal) / 5; 
        let fedCutProb = 67.8;

        // Bot Deƒüi≈ükenleri
        let botActive = false;
        let botScore = 0; 

        // --- 3. UI UPDATE ---
        function updateGlobalTotals() {
            const total24h = longLiqTotal + shortLiqTotal;
            const elGlobal = document.getElementById('global-liq-total-small');
            if(elGlobal) elGlobal.innerText = formatMoney(total24h);
            
            const el24h = document.getElementById('detail-24h-val');
            if(el24h) el24h.innerText = formatMoney(total24h, true);
            
            document.getElementById('detail-4h-val').innerText = formatMoney(fourHourTotal, true);
            document.getElementById('detail-1h-val').innerText = formatMoney(hourlyTotal, true);
            document.getElementById('long-liq-detail').innerText = formatMoney(longLiqTotal);
            document.getElementById('short-liq-detail').innerText = formatMoney(shortLiqTotal);

            const longPct = ((longLiqTotal / total24h) * 100).toFixed(1);
            const shortPct = (100 - longPct).toFixed(1);
            const barLong = document.getElementById('bar-long');
            const barShort = document.getElementById('bar-short');
            barLong.style.width = longPct + '%';
            barLong.innerText = `%${Math.round(longPct)}`;
            barShort.style.width = shortPct + '%';
            barShort.innerText = `%${Math.round(shortPct)}`;
        }

        function updateFedProb() {
            const change = (Math.random() - 0.5) * 0.1; 
            let displayCut = fedCutProb + change; let displayHold = 100 - displayCut;
            document.getElementById('fed-cut-bar').style.width = displayCut + '%';
            document.getElementById('fed-hold-bar').style.width = displayHold + '%';
            document.getElementById('fed-cut-val').innerText = '%' + displayCut.toFixed(1);
            document.getElementById('fed-hold-val').innerText = '%' + displayHold.toFixed(1);
        }

        function triggerFlash(elementId, type) {
            const el = document.getElementById(elementId);
            if(!el) return;
            el.classList.remove('flash-up', 'flash-down');
            void el.offsetWidth; 
            el.classList.add(type === 'up' ? 'flash-up' : 'flash-down');
        }

        function updateRSI_UI(rsi) {
            const rsiVal = document.getElementById('rsi-val');
            const rsiLabel = document.getElementById('rsi-label');
            const rsiMarker = document.getElementById('rsi-marker');
            const rsiComment = document.getElementById('rsi-comment');
            rsiVal.innerText = rsi.toFixed(1); rsiMarker.style.left = rsi + '%'; 
            let comment = "", borderColor = "";

            if (rsi >= 70) {
                rsiLabel.innerText = "A≈ûIRI ALIM"; rsiLabel.style.color = "var(--down-color)"; rsiVal.style.color = "var(--down-color)";
                comment = "Fiyat 'pahalƒ±' b√∂lgede. D√ºzeltme riski y√ºksek."; borderColor = "var(--down-color)";
            } else if (rsi >= 60) {
                rsiLabel.innerText = "G√ú√áL√ú TREND"; rsiLabel.style.color = "var(--up-color)"; rsiVal.style.color = "var(--up-color)";
                comment = "Trend g√º√ßl√º. Boƒüalar kontrol√º elinde tutuyor."; borderColor = "var(--up-color)";
            } else if (rsi >= 40) {
                rsiLabel.innerText = "N√ñTR"; rsiLabel.style.color = "var(--rsi-neutral)"; rsiVal.style.color = "#fff";
                comment = "Piyasa kararsƒ±z. Kƒ±rƒ±lƒ±m beklenmeli."; borderColor = "var(--rsi-neutral)";
            } else if (rsi >= 30) {
                rsiLabel.innerText = "SATI≈û BASKISI"; rsiLabel.style.color = "#f97316"; rsiVal.style.color = "#f97316";
                comment = "Ayƒ±lar baskƒ±n. Hen√ºz dip sinyali yok."; borderColor = "#f97316";
            } else {
                rsiLabel.innerText = "A≈ûIRI SATIM"; rsiLabel.style.color = "var(--up-color)"; rsiVal.style.color = "var(--up-color)";
                comment = "Fiyat 'ucuz' b√∂lgede. Tepki y√ºkseli≈üi gelebilir."; borderColor = "var(--up-color)";
            }
            rsiComment.innerHTML = comment; rsiComment.style.borderLeftColor = borderColor;
        }

        function updateMACDUI(macd, signal, hist, suffix) {
            const statusEl = document.getElementById(`macd-status-${suffix}`);
            const valMacd = document.getElementById(`val-macd-${suffix}`);
            const valHist = document.getElementById(`val-hist-${suffix}`);
            const container = document.getElementById(`hist-bars-${suffix}`);
            
            if (!statusEl || !valMacd || !valHist || !container) return;

            valMacd.innerText = macd.toFixed(2); valHist.innerText = hist.toFixed(2);
            if (hist > 0) {
                if (macd < 0) { statusEl.innerText = "AL (Dƒ∞P)"; statusEl.className = "macd-signal-big text-green"; }
                else { statusEl.innerText = "G√ú√áL√ú AL"; statusEl.className = "macd-signal-big text-green"; }
            } else {
                if (macd > 0) { statusEl.innerText = "SAT (TEPE)"; statusEl.className = "macd-signal-big text-red"; }
                else { statusEl.innerText = "G√ú√áL√ú SAT"; statusEl.className = "macd-signal-big text-red"; }
            }
            container.innerHTML = '';
            for(let i=0; i<6; i++) {
                const bar = document.createElement('div'); bar.className = 'hist-bar';
                let h = Math.random() * 60 + 20; let color = (hist > 0) ? 'var(--up-color)' : 'var(--down-color)';
                if (Math.random() > 0.8) color = '#848e9c'; 
                if(i === 5) { color = (hist > 0) ? 'var(--up-color)' : 'var(--down-color)'; h = 90; }
                bar.style.height = h + '%'; bar.style.background = color; container.appendChild(bar);
            }
        }

        // --- BOT MANTIƒûI (MULTI-INDICATOR + TARGETS) ---
        function toggleBot() {
            botActive = document.getElementById('bot-toggle').checked;
            const statusEl = document.getElementById('bot-status-text');
            if (botActive) {
                statusEl.innerText = "Bot √áalƒ±≈üƒ±yor (Analiz Ediliyor)";
                statusEl.className = "bot-status-text bot-active";
                addBotLog("Sistem ba≈ülatƒ±ldƒ±. Veriler toplanƒ±yor...");
                runAdvancedBotStrategy(); 
            } else {
                statusEl.innerText = "Bot Durduruldu";
                statusEl.className = "bot-status-text";
                addBotLog("Sistem durduruldu.");
            }
        }

        function addBotLog(msg, type = "log-info") {
            const log = document.getElementById('bot-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            log.prepend(entry);
        }
        
        // Geli≈ümi≈ü Strateji Motoru
        async function runAdvancedBotStrategy() {
            if(!botActive) return;
            
            try {
                const res = await fetch('https://api.bybit.com/v5/market/kline?category=inverse&symbol=BTCUSD&interval=60&limit=200');
                const json = await res.json();
                if (json.retCode !== 0) return;
                const closes = json.result.list.map(d => parseFloat(d[4])).reverse(); 
                
                // Hesaplamalar
                const rsi = calculateRSI_Raw(closes, 14);
                const { macdLine, signalLine } = calculateMACD_Raw(closes);
                const { upper, lower, sma } = calculateBB_Raw(closes, 20, 2);
                const ema50 = calculateEMA_Raw(closes, 50);
                const ema200 = calculateEMA_Raw(closes, 200);
                
                const lastClose = closes[closes.length - 1];
                const lastMACD = macdLine[macdLine.length - 1];
                const lastSignal = signalLine[signalLine.length - 1];
                
                // TARGETLERƒ∞ G√úNCELLE
                const safeBuy = lower;
                const targetSell = sma;
                const stopLoss = lower * 0.985; // %1.5 Altƒ±

                document.getElementById('target-buy').innerText = '$' + Math.floor(safeBuy).toLocaleString();
                document.getElementById('target-sell').innerText = '$' + Math.floor(targetSell).toLocaleString();
                document.getElementById('target-stop').innerText = '$' + Math.floor(stopLoss).toLocaleString();

                // PUANLAMA Sƒ∞STEMƒ∞ (-10 ile +10 arasƒ±)
                let score = 0;
                
                // 1. RSI Analizi
                let rsiStatus = "N√ñTR";
                if (rsi < 30) { score += 2; rsiStatus = "A≈ûIRI SATIM"; }
                else if (rsi > 70) { score -= 2; rsiStatus = "A≈ûIRI ALIM"; }
                else if (rsi > 50) { score += 0.5; } 
                
                // 2. MACD Analizi
                let macdStatus = "N√ñTR";
                if (lastMACD > lastSignal) { score += 2; macdStatus = "AL"; }
                else { score -= 2; macdStatus = "SAT"; }
                
                // 3. Bollinger Analizi
                let bbStatus = "N√ñTR";
                if (lastClose < lower) { score += 3; bbStatus = "Dƒ∞P (AL)"; } 
                else if (lastClose > upper) { score -= 3; bbStatus = "TEPE (SAT)"; }
                
                // 4. Trend Analizi (EMA)
                let trendStatus = "N√ñTR";
                const lastEMA50 = ema50[ema50.length - 1];
                const lastEMA200 = ema200[ema200.length - 1];
                if (lastClose > lastEMA200) { score += 1; trendStatus = "Y√úKSELƒ∞≈û"; }
                else { score -= 1; trendStatus = "D√ú≈û√ú≈û"; }
                if (lastEMA50 > lastEMA200) score += 1; 
                
                updateBotStatusUI(rsiStatus, macdStatus, bbStatus, trendStatus, score);
                
                if (score >= 4) {
                     addBotLog(`G√ú√áL√ú AL Sƒ∞NYALƒ∞! Puan: ${score}`, "log-buy");
                } else if (score <= -4) {
                     addBotLog(`G√ú√áL√ú SAT Sƒ∞NYALƒ∞! Puan: ${score}`, "log-sell");
                }
                
            } catch(e) { console.log(e); }
        }
        
        function updateBotStatusUI(rsi, macd, bb, trend, score) {
            setIndBox('ind-box-rsi', 'ind-val-rsi', rsi);
            setIndBox('ind-box-macd', 'ind-val-macd', macd);
            setIndBox('ind-box-bb', 'ind-val-bb', bb);
            setIndBox('ind-box-ema', 'ind-val-ema', trend);
            
            const percent = ((score + 10) / 20) * 100;
            document.getElementById('decision-marker').style.left = `${percent}%`;
        }
        
        function setIndBox(boxId, valId, status) {
            const box = document.getElementById(boxId);
            const val = document.getElementById(valId);
            val.innerText = status;
            
            if (status.includes("AL") || status === "Y√úKSELƒ∞≈û" || status === "A≈ûIRI SATIM") {
                box.style.borderColor = "var(--up-color)";
                val.style.color = "var(--up-color)";
            } else if (status.includes("SAT") || status === "D√ú≈û√ú≈û" || status === "A≈ûIRI ALIM") {
                box.style.borderColor = "var(--down-color)";
                val.style.color = "var(--down-color)";
            } else {
                box.style.borderColor = "#2b3139";
                val.style.color = "#fff";
            }
        }
        
        function calculateRSI_Raw(closes, period) {
            let gains=0, losses=0;
            for(let i=1; i<=period; i++) {
                let chg = closes[i]-closes[i-1];
                if(chg>0) gains+=chg; else losses+=Math.abs(chg);
            }
            let avgGain=gains/period, avgLoss=losses/period;
            for(let i=period+1; i<closes.length; i++) {
                let chg = closes[i]-closes[i-1];
                let g = chg>0?chg:0; let l = chg<0?Math.abs(chg):0;
                avgGain=((avgGain*13)+g)/14; avgLoss=((avgLoss*13)+l)/14;
            }
            return 100-(100/(1+(avgGain/avgLoss)));
        }
        function calculateEMA_Raw(prices, period) {
            const k = 2/(period+1);
            let emaArr = [prices[0]];
            for(let i=1; i<prices.length; i++) {
                emaArr.push(prices[i]*k + emaArr[i-1]*(1-k));
            }
            return emaArr;
        }
        function calculateMACD_Raw(closes) {
            const ema12 = calculateEMA_Raw(closes, 12);
            const ema26 = calculateEMA_Raw(closes, 26);
            let macdLine = [];
            for(let i=0; i<closes.length; i++) macdLine.push(ema12[i]-ema26[i]);
            const signalLine = calculateEMA_Raw(macdLine, 9);
            return { macdLine, signalLine };
        }
        function calculateBB_Raw(closes, period, stdMult) {
            const slice = closes.slice(-period);
            let sum=0; slice.forEach(v => sum+=v);
            const sma = sum/period;
            let sumSq=0; slice.forEach(v => sumSq+=Math.pow(v-sma,2));
            const std = Math.sqrt(sumSq/period);
            return { upper: sma+(std*stdMult), lower: sma-(std*stdMult), sma };
        }


        // --- TELEGRAM DOM ---
        function addTelegramMessageDOM(symbol, side, price, totalVal, timeStr, container, isNew = true) {
            if(totalVal < 500) return; 
            const isLong = side === 'SELL'; 
            const emoji = isLong ? 'üü¢' : 'üî¥'; 
            const typeText = isLong ? 'Liquidated Long' : 'Liquidated Short';
            const colorClass = isLong ? 'tg-long' : 'tg-short';
            let whaleAlert = totalVal > 50000 ? "üêã WHALE! " : "";

            const msg = document.createElement('div');
            msg.className = `tg-msg ${colorClass}`;
            if(isNew) msg.style.animation = "slideInRight 0.3s ease-out";
            
            msg.innerHTML = `
                <div class="tg-header"><span>${emoji} ${typeText}</span><span>${symbol}</span></div>
                <div style="font-size:0.8rem; margin-bottom:5px; color:#fff;">${whaleAlert} <b>${formatMoney(totalVal)}</b></div>
                <div class="tg-row"><span style="color:var(--text-secondary)">Price:</span><span>$${price.toLocaleString()}</span></div>
                <div class="tg-time">${timeStr}</div>
            `;
            if(isNew) container.prepend(msg); else container.appendChild(msg); 
            if (container.children.length > 50) container.removeChild(container.lastChild);
        }

        function addTelegramMessage(symbol, side, price, qty) {
            const container = document.getElementById('tg-feed');
            const totalVal = price * qty;
            addTelegramMessageDOM(symbol, side, price, totalVal, new Date().toLocaleTimeString(), container, true);
        }

        // --- 4. API & DATA FETCHING ---
        
        async function updateInitialLiquidationsBasedOnVolatility() {
            try {
                const res = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
                const data = await res.json();
                const changePercent = Math.abs(parseFloat(data.priceChangePercent));
                const baseLiquidation = 100000000;
                const volatilityImpact = changePercent * 50000000; 
                const isDrop = parseFloat(data.priceChangePercent) < 0;
                
                let estimatedTotal = baseLiquidation + volatilityImpact;
                
                if(isDrop) {
                    longLiqTotal = estimatedTotal * 0.8; 
                    shortLiqTotal = estimatedTotal * 0.2;
                } else {
                    longLiqTotal = estimatedTotal * 0.2;
                    shortLiqTotal = estimatedTotal * 0.8;
                }
                
                hourlyTotal = estimatedTotal / 12;
                fourHourTotal = estimatedTotal / 4;
                updateGlobalTotals();
            } catch(e) {}
        }

        async function calculateDailyRSI() {
            try {
                const res = await fetch('https://api.bybit.com/v5/market/kline?category=inverse&symbol=BTCUSD&interval=D&limit=30');
                const json = await res.json();
                if (json.retCode !== 0) throw new Error("Bybit API");
                const list = json.result.list.reverse();
                const closes = list.map(d => parseFloat(d[4])); 
                const period = 14; let gains = 0, losses = 0;
                for (let i = 1; i <= period; i++) {
                    const change = closes[i] - closes[i - 1];
                    if (change > 0) gains += change; else losses += Math.abs(change);
                }
                let avgGain = gains / period, avgLoss = losses / period;
                for (let i = period + 1; i < closes.length; i++) {
                    const change = closes[i] - closes[i - 1];
                    const cG = change > 0 ? change : 0; const cL = change < 0 ? Math.abs(change) : 0;
                    avgGain = ((avgGain * 13) + cG) / 14; avgLoss = ((avgLoss * 13) + cL) / 14;
                }
                const rs = avgGain / avgLoss; let rsi = 100 - (100 / (1 + rs));
                updateRSI_UI(rsi);
            } catch(e) { updateRSI_UI(50); }
        }

        async function updateAllMACD() { await calculateMACD('240', '4h'); await calculateMACD('D', '1d'); }
        
        async function calculateMACD(interval, suffix) {
            try {
                const res = await fetch(`https://api.bybit.com/v5/market/kline?category=inverse&symbol=BTCUSD&interval=${interval}&limit=60`);
                const json = await res.json();
                if (json.retCode !== 0) throw new Error("Bybit API");
                
                const list = json.result.list.reverse();
                const closes = list.map(d => parseFloat(d[4]));
                
                const calculateEMA = (period, prices) => {
                    const k = 2 / (period + 1); let ema = prices[0]; let emaArray = [ema];
                    for(let i = 1; i < prices.length; i++) { ema = (prices[i] * k) + (ema * (1 - k)); emaArray.push(ema); }
                    return emaArray;
                };
                const ema12 = calculateEMA(12, closes); const ema26 = calculateEMA(26, closes);
                let macdLine = []; for(let i=0; i<closes.length; i++) { macdLine.push(ema12[i] - ema26[i]); }
                const signalLine = calculateEMA(9, macdLine);
                const lastMACD = macdLine[macdLine.length - 1]; const lastSignal = signalLine[signalLine.length - 1];
                const histogram = lastMACD - lastSignal;
                updateMACDUI(lastMACD, lastSignal, histogram, suffix);
            } catch (e) {}
        }

        async function fetchRecentHistory() {
            const container = document.getElementById('tg-feed');
            container.innerHTML = '<div class="tg-msg" style="text-align:center; color:#666;">Ge√ßmi≈ü veriler alƒ±nƒ±yor...</div>';
            try {
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT', 'BNBUSDT'];
                let allOrders = [];
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                for(const sym of symbols) {
                    const targetUrl = `https://api.binance.com/api/v3/trades?symbol=${sym}&limit=5`;
                    const res = await fetch(proxyUrl + encodeURIComponent(targetUrl));
                    const data = await res.json();
                    if(Array.isArray(data)) {
                        data.forEach(t => {
                            t.symbol = sym;
                            t.origQty = t.qty;
                            t.side = t.isBuyerMaker ? 'SELL' : 'BUY'; 
                        });
                        allOrders = allOrders.concat(data);
                    }
                }
                allOrders.sort((a, b) => b.time - a.time);
                if(allOrders.length > 0) {
                    container.innerHTML = ''; 
                    allOrders.forEach(order => {
                        const price = parseFloat(order.price);
                        const qty = parseFloat(order.qty);
                        const totalVal = price * qty;
                        if(totalVal > 1000) {
                            const timeStr = new Date(order.time).toLocaleTimeString();
                            addTelegramMessageDOM(order.symbol, order.side, price, totalVal, timeStr, container, false);
                        }
                    });
                } else {
                    container.innerHTML = '<div class="tg-msg" style="text-align:center;">Ge√ßmi≈ü veri bulunamadƒ±. Canlƒ± bekleniyor...</div>';
                }
            } catch (e) { 
                container.innerHTML = '<div class="tg-msg" style="text-align:center;">Canlƒ± akƒ±≈ü bekleniyor...</div>'; 
            }
        }

        // --- 5. WEBSOCKET SETUP ---
        const wsPrice = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        wsPrice.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const price = parseFloat(data.c);
            const change = parseFloat(data.P);
            const pEl = document.getElementById('btc-price');
            const cEl = document.getElementById('btc-change');
            pEl.innerText = '$' + price.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
            pEl.style.color = price > currentPrice ? 'var(--up-color)' : (price < currentPrice ? 'var(--down-color)' : '#fff');
            
            // Bot Fiyat G√ºncelleme
            document.getElementById('bot-live-price').innerText = '$' + price.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
            
            currentPrice = price;
            const sign = change >= 0 ? '+' : '';
            const colorClass = change >= 0 ? 'text-green' : 'text-red';
            cEl.innerHTML = `<span class="${colorClass}">${sign}%${change}</span> (24s)`;
        };

        const wsLiq = new WebSocket('wss://fstream.binance.com/ws/!forceOrder@arr');
        wsLiq.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const order = data.o;
            const price = parseFloat(order.p);
            const qty = parseFloat(order.q);
            const rawAmount = price * qty;
            
            const marketMultiplier = 2.5 + Math.random() * 0.8; 
            const globalEstimatedAmount = rawAmount * marketMultiplier;

            if (order.S === 'SELL') longLiqTotal += globalEstimatedAmount; else shortLiqTotal += globalEstimatedAmount;
            
            hourlyTotal += globalEstimatedAmount;
            fourHourTotal += globalEstimatedAmount;
            
            updateGlobalTotals();
            triggerFlash('box-1h', 'up'); 
            addTelegramMessageDOM(order.s, order.S, price, rawAmount, new Date().toLocaleTimeString(), document.getElementById('tg-feed'), true);
        };

        // --- 6. INIT ---
        fetch('https://api.alternative.me/fng/?limit=1').then(r => r.json()).then(d => {
            const val = d.data[0].value;
            const bar = document.getElementById('fear-bar');
            document.getElementById('fear-val').innerText = val;
            let label = val < 25 ? 'A≈üƒ±rƒ± Korku' : (val > 75 ? 'A≈üƒ±rƒ± A√ßg√∂zl√ºl√ºk' : 'N√∂tr');
            document.getElementById('fear-text').innerText = label;
            bar.style.width = val + '%';
            if(val < 25) { bar.style.background = 'var(--down-color)'; document.getElementById('fear-text').className = 'text-red'; }
            else if(val > 75) { bar.style.background = 'var(--up-color)'; document.getElementById('fear-text').className = 'text-green'; }
            else { bar.style.background = '#f97316'; document.getElementById('fear-text').style.color = '#f97316'; }
        }).catch(e => {});

        // Ba≈ülat
        updateInitialLiquidationsBasedOnVolatility(); 
        fetchRecentHistory();
        updateAllMACD();
        calculateDailyRSI(); 
        
        // Hƒ±zlƒ± g√ºncelleme d√∂ng√ºs√º
        setInterval(() => {
            updateGlobalTotals(); 
            updateFedProb(); 
        }, 500); 

        setInterval(updateAllMACD, 60000); 
        setInterval(calculateDailyRSI, 60000); 
        setInterval(runAdvancedBotStrategy, 10000); // Bot her 10 saniyede bir analiz yapar

    </script>
</body>
</html>